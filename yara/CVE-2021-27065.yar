rule OperaDLLSOH_CVE202127065_92877_27664 {
   meta:
    description = "Detects DLL SOH payload used during exploitation of CVE-2021-27065"
    author = "Emanuele De Lucia"
    hash1 = "b212655aeb4700f247070ba5ca6d9c742793f108881d07e4d1cdc4ede175fcff"
   strings:
	  $s1 = "opera_browser.dll" fullword ascii 
	  $s2 = "opera_browser.png" fullword ascii
    $s3 = "OperaDllMain" fullword ascii 
	  $s4 = "operator<=>" fullword ascii 
	  $op1 = {68 dc 0c 01 10 ff 15 00 c0 00 10 50 ff 15 24 c0 00 10}
	  $op2 = {6a 40 68 00 30 00 00 52 6a 00 89 45 fc ff 15 0c c0 00}
   condition:
	  (uint16(0) == 0x5a4d and 
	  filesize < 100KB and
    (all of ($s*) or
	  all of ($op*)))
}
